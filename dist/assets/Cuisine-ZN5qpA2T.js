import{r as o,u as y,d as m,j as e,C as b}from"./index-DHz37_S4.js";import{g as j,O as v}from"./orderUrgency-CM13h-Xp.js";const w=({order:a,onReady:c,canMarkReady:d})=>{const u=j(a.date_envoi_cuisine||Date.now()),i=o.useMemo(()=>{const t=[],s=new Map;return a.items.forEach(r=>{var g;const x=(g=r.commentaire)==null?void 0:g.trim(),h=x||"no_comment",l=`${r.produitRef}::${h}`;if(x){t.push({key:`${l}::${r.id}`,nom_produit:r.nom_produit,quantite:r.quantite,commentaire:x});return}const p=s.get(l);if(p!==void 0){t[p].quantite+=r.quantite;return}s.set(l,t.length),t.push({key:l,nom_produit:r.nom_produit,quantite:r.quantite})}),t},[a.items]),n=new Date(a.date_envoi_cuisine||Date.now()).toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:`flex h-full flex-col overflow-hidden rounded-xl bg-white text-gray-900 shadow-lg transition-shadow duration-300 hover:shadow-xl ${u.border}`,children:[e.jsx("header",{className:"border-b border-gray-200 px-5 pt-5 pb-4",children:e.jsxs("div",{className:"flex w-full flex-col gap-4",children:[e.jsx("h3",{className:"w-full text-center text-3xl font-semibold text-gray-900 sm:text-left sm:text-4xl",children:a.table_nom||`Para llevar #${a.id.slice(-4)}`}),e.jsx(v,{startTime:a.date_envoi_cuisine||Date.now(),className:"w-full justify-center rounded-xl px-0 text-xl sm:justify-start sm:rounded-full sm:px-4 sm:text-2xl"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-5 py-4",children:e.jsx("ul",{className:"space-y-3",children:i.map(t=>e.jsxs("li",{className:"rounded-lg border border-gray-200 bg-gray-50 px-4 py-3 shadow-sm",children:[e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[t.quantite,"x ",t.nom_produit]}),t.commentaire&&e.jsx("p",{className:"mt-2 rounded-md border border-dashed border-blue-200 bg-blue-50 px-3 py-2 text-sm font-medium italic text-blue-800",children:t.commentaire})]},t.key))})}),e.jsx("footer",{className:"border-t border-gray-200 px-5 pb-5 pt-4",children:e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["Enviado ",n]}),d&&e.jsxs("button",{onClick:()=>c(a.id),className:"group inline-flex w-full items-center justify-center gap-3 rounded-lg border-2 border-transparent bg-black px-4 py-3 text-lg font-semibold uppercase tracking-[0.2em] text-white shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-black/70 focus-visible:ring-offset-2 hover:bg-neutral-900",children:[e.jsx(b,{size:22,className:"shrink-0"}),e.jsx("span",{children:"LISTO"})]})]})})]})},_=()=>{const[a,c]=o.useState([]),[d,u]=o.useState(!0),{role:i}=y(),f=(i==null?void 0:i.permissions["/cocina"])==="editor",n=o.useCallback(async()=>{try{const s=await m.getKitchenOrders();c(s)}catch(s){console.error("Failed to fetch kitchen orders",s)}finally{u(!1)}},[]);o.useEffect(()=>{n();const s=setInterval(n,5e3),r=m.notifications.subscribe("orders_updated",n);return()=>{clearInterval(s),r()}},[n]);const t=async s=>{try{await m.markOrderAsReady(s),n()}catch(r){console.error("Failed to mark order as ready",r)}};return d?e.jsx("div",{className:"text-gray-700",children:"Cargando pedidos de cocina..."}):e.jsx("div",{className:"flex h-full flex-col",children:a.length===0?e.jsx("div",{className:"mt-6 flex flex-1 items-center justify-center text-2xl text-gray-500",children:"No hay pedidos en preparaciÃ³n."}):e.jsx("div",{className:"mt-6 grid flex-1 grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:a.map(s=>e.jsx(w,{order:s,onReady:t,canMarkReady:f},s.ticketKey))})})};export{_ as default};
