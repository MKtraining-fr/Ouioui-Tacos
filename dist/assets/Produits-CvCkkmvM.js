import{r as s,R as H,s as X,j as e,u as J,l as K,d as f,n as c,M as Q}from"./index-DHz37_S4.js";import{a as Y,b as ee,F as re}from"./TrashIcon-Bet72WXf.js";function se({title:a,titleId:n,...o},i){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":n},o),a?s.createElement("title",{id:n},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))}const ae=s.forwardRef(se);function te({title:a,titleId:n,...o},i){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":n},o),a?s.createElement("title",{id:n},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))}const le=s.forwardRef(te);function ne({title:a,titleId:n,...o},i){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":n},o),a?s.createElement("title",{id:n},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const ie=s.forwardRef(ne),oe=({product:a,openEditModal:n,handleDeleteProduct:o,canManageProducts:i})=>{const N=s.useMemo(()=>X(a.image_url,200,200),[a.image_url]);return e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden flex flex-col","aria-label":`Produit ${a.name}`,tabIndex:0,children:[e.jsx("img",{src:N,alt:a.name,className:"w-full h-48 object-cover",loading:"lazy"}),e.jsxs("div",{className:"p-4 flex-grow flex flex-col",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:a.name}),e.jsx("p",{className:"text-gray-600 text-sm flex-grow",children:a.description}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("span",{className:"font-bold text-xl text-brand-primary",children:[a.price.toFixed(2)," €"]}),i&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>n(a),className:"p-2 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50","aria-label":`Modifier ${a.name}`,children:e.jsx(Y,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>o(a.id),className:"p-2 rounded-full bg-red-100 text-red-600 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50","aria-label":`Supprimer ${a.name}`,children:e.jsx(ee,{className:"h-5 w-5"})})]})]})]})]})},ce=H.memo(oe),me=()=>{var O,U;const{role:a}=J();K();const[n,o]=s.useState([]),[i,N]=s.useState([]),[D,d]=s.useState(!0),[F,M]=s.useState(null),[T,C]=s.useState(!1),[P,R]=s.useState(null),[y,I]=s.useState("add"),[l,m]=s.useState({name:"",description:"",price:0,category_id:"",image_url:"",is_available:!0,is_best_seller:!1,best_seller_rank:null}),[g,E]=s.useState(null),[S,x]=s.useState(null),[w,q]=s.useState("all"),[j,B]=s.useState(""),L=(U=(O=a==null?void 0:a.permissions)==null?void 0:O["/produits"])==null?void 0:U.write,b=s.useCallback(async()=>{d(!0);try{const r=await f.getProducts();o(r)}catch{c.showError("Erreur lors du chargement des produits."),M("Impossible de charger les produits.")}finally{d(!1)}},[]),A=s.useCallback(async()=>{try{const r=await f.getCategories();N(r)}catch{c.showError("Erreur lors du chargement des catégories."),M("Impossible de charger les catégories.")}},[]);s.useEffect(()=>{b(),A()},[b,A]);const u=r=>{const{name:t,value:h,type:k}=r.target;m(k==="checkbox"?p=>({...p,[t]:r.target.checked}):t==="best_seller_rank"?p=>({...p,[t]:h?parseInt(h,10):null}):p=>({...p,[t]:h}))},W=r=>{if(r.target.files&&r.target.files[0]){const t=r.target.files[0];E(t),x(URL.createObjectURL(t))}else E(null),x(null)},v=s.useCallback(()=>{m({name:"",description:"",price:0,category_id:"",image_url:"",is_available:!0,is_best_seller:!1,best_seller_rank:null}),R(null),E(null),x(null),I("add")},[]),Z=s.useCallback(()=>{v(),C(!0)},[v]),V=s.useCallback(r=>{R(r),m({name:r.name,description:r.description||"",price:r.price,category_id:r.category_id||"",image_url:r.image_url||"",is_available:r.is_available,is_best_seller:r.is_best_seller,best_seller_rank:r.best_seller_rank||null}),x(r.image_url||null),I("edit"),C(!0)},[]),_=s.useCallback(()=>{C(!1),v()},[v]),z=s.useCallback(async r=>{r.preventDefault(),d(!0);try{let t=l.image_url;if(g){const k=await f.uploadProductImage(g);if(k)t=k.url;else{c.showError("Échec du téléchargement de l'image."),d(!1);return}}const h={...l,image_url:t,price:parseFloat(l.price.toString()),best_seller_rank:l.is_best_seller?l.best_seller_rank:null};y==="add"?(await f.createProduct(h),c.showSuccess("Produit ajouté avec succès !")):P&&(await f.updateProduct(P.id,h),c.showSuccess("Produit mis à jour avec succès !")),_(),b()}catch{c.showError("Erreur lors de l'enregistrement du produit.")}finally{d(!1)}},[y,l,g,P,_,b]),G=s.useCallback(async r=>{if(window.confirm("Êtes-vous sûr de vouloir supprimer ce produit ?")){d(!0);try{await f.deleteProduct(r),c.showSuccess("Produit supprimé avec succès !"),b()}catch{c.showError("Erreur lors de la suppression du produit.")}finally{d(!1)}}},[b]),$=s.useMemo(()=>{let r=n;return w!=="all"&&(r=r.filter(t=>t.category_id===w)),j&&(r=r.filter(t=>t.name.toLowerCase().includes(j.toLowerCase()))),r},[n,w,j]);return D?e.jsx("div",{className:"text-center py-8",children:"Chargement des produits..."}):F?e.jsx("div",{className:"text-center py-8 text-red-500",children:F}):e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Gestion des Produits"}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 space-y-4 md:space-y-0",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("select",{value:w,onChange:r=>q(r.target.value),className:"p-2 border border-gray-300 rounded-md shadow-sm focus:ring-brand-primary focus:border-brand-primary","aria-label":"Filtrer par catégorie",children:[e.jsx("option",{value:"all",children:"Toutes les catégories"}),i.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),e.jsx("input",{type:"text",placeholder:"Rechercher un produit...",value:j,onChange:r=>B(r.target.value),className:"p-2 border border-gray-300 rounded-md shadow-sm p-2 focus:ring-brand-primary focus:border-brand-primary","aria-label":"Champ de recherche de produit"})]}),L&&e.jsxs("button",{onClick:Z,className:"flex items-center px-4 py-2 bg-brand-primary text-white rounded-md shadow-sm hover:bg-brand-dark focus:outline-none focus:ring-2 focus:ring-brand-primary focus:ring-opacity-50","aria-label":"Ajouter un nouveau produit",children:[e.jsx(re,{className:"h-5 w-5 mr-2"}),"Ajouter Produit"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:$.length>0?$.map(r=>e.jsx(ce,{product:r,openEditModal:V,handleDeleteProduct:G,canManageProducts:L},r.id)):e.jsx("p",{className:"col-span-full text-center text-gray-500",children:"Aucun produit trouvé."})}),e.jsx(Q,{isOpen:T,onClose:_,title:y==="add"?"Ajouter un Produit":"Modifier le Produit",children:e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Nom"}),e.jsx("input",{type:"text",name:"name",id:"name",value:l.name,onChange:u,required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-brand-primary focus:border-brand-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{name:"description",id:"description",value:l.description,onChange:u,rows:3,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-brand-primary focus:border-brand-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700",children:"Prix"}),e.jsx("input",{type:"number",name:"price",id:"price",value:l.price,onChange:u,required:!0,min:"0",step:"0.01",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-brand-primary focus:border-brand-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category_id",className:"block text-sm font-medium text-gray-700",children:"Catégorie"}),e.jsxs("select",{name:"category_id",id:"category_id",value:l.category_id,onChange:u,required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-brand-primary focus:border-brand-primary",children:[e.jsx("option",{value:"",children:"Sélectionner une catégorie"}),i.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"image_url",className:"block text-sm font-medium text-gray-700",children:"Image"}),e.jsxs("div",{className:"mt-1 flex items-center space-x-4",children:[S&&e.jsx("img",{src:S,alt:"Aperçu",className:"h-20 w-20 object-cover rounded-md"}),e.jsxs("label",{className:"cursor-pointer bg-white py-2 px-3 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-brand-primary",children:[e.jsx(le,{className:"h-5 w-5 inline-block mr-2"}),e.jsx("span",{children:g?g.name:l.image_url?"Changer l'image":"Télécharger une image"}),e.jsx("input",{id:"image_url",name:"image_url",type:"file",className:"sr-only",onChange:W,accept:"image/*"})]}),S&&!g&&e.jsx("button",{type:"button",onClick:()=>{m(r=>({...r,image_url:""})),x(null)},className:"p-2 rounded-full bg-red-100 text-red-600 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50","aria-label":"Supprimer l'image existante",children:e.jsx(ie,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"is_available",name:"is_available",type:"checkbox",checked:l.is_available,onChange:u,className:"h-4 w-4 text-brand-primary focus:ring-brand-primary border-gray-300 rounded"}),e.jsx("label",{htmlFor:"is_available",className:"ml-2 block text-sm text-gray-900",children:"Disponible"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"is_best_seller",name:"is_best_seller",type:"checkbox",checked:l.is_best_seller,onChange:u,className:"h-4 w-4 text-brand-primary focus:ring-brand-primary border-gray-300 rounded"}),e.jsx("label",{htmlFor:"is_best_seller",className:"ml-2 block text-sm text-gray-900",children:"Meilleure vente"})]}),l.is_best_seller&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"best_seller_rank",className:"block text-sm font-medium text-gray-700",children:"Rang meilleure vente"}),e.jsx("input",{type:"number",name:"best_seller_rank",id:"best_seller_rank",value:l.best_seller_rank||"",onChange:u,min:"1",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-brand-primary focus:border-brand-primary"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:_,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-primary",children:"Annuler"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-brand-primary text-white rounded-md shadow-sm text-sm font-medium hover:bg-brand-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-primary",children:[e.jsx(ae,{className:"h-5 w-5 inline-block mr-2"}),y==="add"?"Ajouter":"Enregistrer"]})]})]})})]})};export{me as default};
