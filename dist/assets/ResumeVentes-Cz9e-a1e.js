import{c as f,r as c,j as e,R as D,t as _,U as C,v as S,h as i,d as k}from"./index-DHz37_S4.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],O=f("chevron-down",M);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],F=f("download",E),z=()=>{const[h,j]=c.useState([]),[y,b]=c.useState(!0),[x,N]=c.useState(null),[n,v]=c.useState({startDate:"",endDate:"",paymentMethod:"all"});c.useEffect(()=>{(async()=>{try{const a=await k.getFinalizedOrders();j([...a].sort((s,l)=>l.date_creation-s.date_creation))}catch(a){console.error("Failed to fetch finalized orders",a)}finally{b(!1)}})()},[]);const d=c.useMemo(()=>h.filter(t=>{const a=new Date(t.date_creation),s=n.startDate?new Date(n.startDate):null,l=n.endDate?new Date(n.endDate):null;s&&s.setHours(0,0,0,0),l&&l.setHours(23,59,59,999);const m=s?a>=s:!0,o=l?a<=l:!0,r=n.paymentMethod==="all"||t.payment_method===n.paymentMethod;return m&&o&&r}),[h,n]),p=t=>{v({...n,[t.target.name]:t.target.value})},w=()=>{const s=[["Fecha","Tipo","Mesa/Cliente","Comensales","Venta total","Beneficio","Método de pago"].join(","),...d.map(r=>{var g;return[new Date(r.date_creation).toLocaleString("es-CO"),r.type==="sur_place"?"En el local":"Para llevar",`"${r.type==="sur_place"?r.table_nom||"N/A":((g=r.clientInfo)==null?void 0:g.nom)||"N/A"}"`,r.couverts,i(r.total),i(r.profit||0),r.payment_method||"N/A"].join(",")})].join(`
`),l=new Blob([`\uFEFF${s}`],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(l),o=document.createElement("a");o.href=m,o.download=`resumen_pedidos_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(m)},u=c.useMemo(()=>d.reduce((t,a)=>(t.totalSales+=a.total,t.totalProfit+=a.profit||0,t),{totalSales:0,totalProfit:0}),[d]);return y?e.jsx("div",{className:"text-gray-800",children:"Cargando el resumen de ventas..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"mt-6 space-y-4 rounded-xl bg-white p-4 shadow-md",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Fecha de inicio"}),e.jsx("input",{type:"date",name:"startDate",value:n.startDate,onChange:p,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-primary focus:border-brand-primary text-gray-900"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Fecha de fin"}),e.jsx("input",{type:"date",name:"endDate",value:n.endDate,onChange:p,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-primary focus:border-brand-primary text-gray-900"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Método de pago"}),e.jsxs("select",{name:"paymentMethod",value:n.paymentMethod,onChange:p,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-primary focus:border-brand-primary text-gray-900",children:[e.jsx("option",{value:"all",children:"Todas"}),e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"transferencia",children:"Transferencia"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"})]})]}),e.jsxs("button",{onClick:w,className:"bg-green-600 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center gap-2 hover:bg-green-700 transition h-12 sm:h-full sm:self-end",children:[e.jsx(F,{size:18})," Export CSV"]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-500 uppercase tracking-wider",children:"Mesa/Cliente"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-500 uppercase tracking-wider text-right",children:"Ventas"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-500 uppercase tracking-wider text-right",children:"Beneficio"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-500 uppercase tracking-wider",children:"Pago"})]})}),e.jsx("tbody",{children:d.map(t=>{var a;return e.jsxs(D.Fragment,{children:[e.jsxs("tr",{onClick:()=>N(x===t.id?null:t.id),className:"border-b hover:bg-gray-50 cursor-pointer",children:[e.jsx("td",{className:"p-3",children:x===t.id?e.jsx(O,{size:16}):e.jsx(_,{size:16})}),e.jsx("td",{className:"p-3 text-sm text-gray-700 whitespace-nowrap",children:new Date(t.date_creation).toLocaleString("es-CO")}),e.jsx("td",{className:"p-3 text-sm",children:t.type==="sur_place"?e.jsxs("span",{className:"inline-flex items-center gap-1.5 py-1 px-2 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(C,{size:12})," En el local"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 py-1 px-2 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:[e.jsx(S,{size:12})," Para llevar"]})}),e.jsx("td",{className:"p-3 font-semibold text-gray-900",children:t.type==="sur_place"?t.table_nom||"N/A":((a=t.clientInfo)==null?void 0:a.nom)||"N/A"}),e.jsx("td",{className:"p-3 text-gray-800 font-bold text-right",children:i(t.total)}),e.jsx("td",{className:"p-3 font-semibold text-green-600 text-right",children:i(t.profit||0)}),e.jsx("td",{className:"p-3 text-gray-700 capitalize",children:t.payment_method||"N/A"})]}),x===t.id&&e.jsx("tr",{className:"bg-gray-50",children:e.jsx("td",{colSpan:7,className:"p-4",children:e.jsxs("div",{className:"p-2 bg-white rounded-md border",children:[e.jsx("h4",{className:"font-semibold mb-2 text-gray-800",children:"Detalle de artículos:"}),e.jsx("ul",{className:"list-disc list-inside pl-2 text-gray-700",children:t.items.map(s=>e.jsxs("li",{children:[s.quantite,"x ",s.nom_produit," - ",e.jsx("span",{className:"font-semibold",children:i(s.prix_unitaire*s.quantite)})]},s.id))})]})})})]},t.id)})}),e.jsx("tfoot",{className:"border-t-2 border-gray-300",children:e.jsxs("tr",{className:"font-bold text-gray-900",children:[e.jsx("td",{colSpan:4,className:"p-3 text-right",children:"TOTALES"}),e.jsx("td",{className:"p-3 text-right",children:i(u.totalSales)}),e.jsx("td",{className:"p-3 text-right text-green-700",children:i(u.totalProfit)}),e.jsx("td",{})]})})]})}),d.length===0&&e.jsx("p",{className:"text-center p-8 text-gray-500",children:"Ningún pedido finalizado coincide con tus filtros."})]})]})};export{z as default};
