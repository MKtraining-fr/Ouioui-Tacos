import{c as f,r,d as p,j as e,U as j,P as N,p as v,h as w,M as _}from"./index-DHz37_S4.js";import{g as O,O as k}from"./orderUrgency-CM13h-Xp.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],I=f("eye",C),b=({order:s,onValidate:m,onDeliver:i,isProcessing:c})=>{const[u,o]=r.useState(!1),d=s.table_nom||`Pedido #${s.id.slice(-6)}`,l=s.date_envoi_cuisine||s.date_creation,t=O(l),g={normal:"Normal",warning:"En seguimiento",critical:"Crítico"};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`relative flex h-full flex-col overflow-hidden rounded-xl border bg-white text-gray-900 shadow-md transition-shadow duration-300 hover:shadow-lg ${t.border}`,children:[e.jsx("span",{"aria-hidden":!0,className:`absolute inset-y-0 left-0 w-1 ${t.accent}`}),e.jsx("header",{className:"border-b border-gray-200 px-5 pt-5 pb-4",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"text-lg sm:text-xl md:text-2xl font-semibold leading-tight text-gray-900",children:d}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Pedido enviado ",new Date(l).toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.18em] ${t.badge}`,children:[e.jsx("span",{className:`h-2 w-2 rounded-full ${t.accent}`}),e.jsx("span",{children:g[t.level]})]})]}),e.jsx(k,{startTime:l,className:"text-sm sm:text-base"})]})}),e.jsxs("div",{className:"flex-1 space-y-4 overflow-y-auto px-5 py-4",children:[s.clientInfo&&e.jsxs("div",{className:"space-y-2 rounded-lg border border-gray-200 bg-gray-50 p-4 shadow-sm",children:[s.clientInfo.nom&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-900",children:[e.jsx(j,{size:16,className:t.icon}),e.jsx("span",{className:"font-medium",children:s.clientInfo.nom})]}),s.clientInfo.telephone&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600 ml-6",children:[e.jsx(N,{size:14,className:"text-gray-500"}),e.jsx("span",{children:s.clientInfo.telephone})]})]}),s.clientInfo.adresse&&e.jsxs("div",{className:"flex items-start gap-2 text-sm text-gray-700",children:[e.jsx(v,{size:16,className:`mt-0.5 text-gray-500 ${t.icon}`}),e.jsx("span",{className:"text-gray-700",children:s.clientInfo.adresse})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-gray-500",children:"Artículos"}),e.jsx("ul",{className:"space-y-2",children:s.items.map(x=>e.jsx("li",{className:"rounded-lg border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-900 shadow-sm",children:e.jsxs("div",{className:"flex items-baseline justify-between gap-3 text-gray-900",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:x.nom_produit}),e.jsxs("span",{className:"text-base sm:text-lg font-bold text-gray-900",children:[x.quantite,"×"]})]})},x.id))})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-gray-200 bg-gray-50 px-4 py-3 font-semibold text-gray-900 shadow-sm",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-lg sm:text-xl text-gray-900",children:w(s.total)})]})]}),e.jsxs("footer",{className:"border-t border-gray-200 px-5 pb-5 pt-4",children:[s.statut==="pendiente_validacion"&&m&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>o(!0),className:"w-full ui-btn ui-btn-secondary",type:"button",children:[e.jsx(I,{size:16,className:t.icon})," ",s.receipt_url?"Ver comprobante":"Comprobante no disponible"]}),e.jsx("button",{onClick:()=>m(s.id),disabled:c,className:"w-full ui-btn ui-btn-info uppercase",type:"button",children:c?"Validando...":"Validar"})]}),s.estado_cocina==="listo"&&i&&e.jsx("button",{onClick:()=>i(s.id),disabled:c,className:"w-full ui-btn ui-btn-success uppercase",type:"button",children:c?"Procesando...":"Entregar"})]})]}),e.jsx(_,{isOpen:u,onClose:()=>o(!1),title:"Comprobante de pago",children:s.receipt_url?e.jsx("img",{src:s.receipt_url,alt:"Comprobante",className:"w-full h-auto rounded-md"}):e.jsx("p",{children:"No se proporcionó comprobante."})})]})},T=()=>{const[s,m]=r.useState([]),[i,c]=r.useState([]),[u,o]=r.useState(!0),[d,l]=r.useState(null),t=r.useCallback(async()=>{try{const{pending:a,ready:n}=await p.getTakeawayOrders();m(a.sort((h,y)=>h.date_creation-y.date_creation)),c(n.sort((h,y)=>(h.date_listo_cuisine||0)-(y.date_listo_cuisine||0)))}catch(a){console.error("Failed to fetch takeaway orders",a)}finally{o(!1)}},[]);r.useEffect(()=>{o(!0),t();const a=setInterval(t,1e4),n=p.notifications.subscribe("orders_updated",t);return()=>{clearInterval(a),n()}},[t]);const g=async a=>{if(!d){l(a);try{await p.validateTakeawayOrder(a),await t()}catch(n){console.error("Failed to validate order:",n),alert(`No se pudo validar el pedido: ${n.message}`)}finally{l(null)}}},x=async a=>{if(!d){l(a);try{await p.markTakeawayAsDelivered(a),await t()}catch(n){console.error("Failed to mark order as delivered:",n),alert("Ocurrió un error al finalizar el pedido.")}finally{l(null)}}};return u?e.jsx("div",{className:"text-gray-700",children:"Cargando pedidos para llevar..."}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-8 md:grid-cols-2",children:[e.jsxs("div",{className:"bg-gray-100 p-4 rounded-xl",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-bold mb-4 text-center text-blue-700",children:["Pendientes de validación (",s.length,")"]}),e.jsx("div",{className:"space-y-4",children:s.length>0?s.map(a=>e.jsx(b,{order:a,onValidate:g,isProcessing:d===a.id},a.id)):e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No hay pedidos para validar."})})]}),e.jsxs("div",{className:"bg-gray-100 p-4 rounded-xl",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-bold mb-4 text-center text-green-700",children:["Pedidos listos (",i.length,")"]}),e.jsx("div",{className:"space-y-4",children:i.length>0?i.map(a=>e.jsx(b,{order:a,onDeliver:x,isProcessing:d===a.id},a.id)):e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No hay pedidos listos."})})]})]})})};export{T as default};
