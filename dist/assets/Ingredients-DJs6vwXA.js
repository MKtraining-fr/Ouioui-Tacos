import{c as v,u as A,r as a,d as b,j as e,h as F,M as k}from"./index-DHz37_S4.js";import{C as O}from"./circle-plus-Se8zv2co.js";import{T as P}from"./trash-2-9S3g-TKh.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M16 16h6",key:"100bgy"}],["path",{d:"M19 13v6",key:"85cyf1"}],["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]],E=v("package-plus",q);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],L=v("search",D);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],R=v("square-pen",$),K=()=>{const{role:d}=A(),[r,x]=a.useState([]),[s,n]=a.useState(!0),[l,i]=a.useState(null),[o,m]=a.useState(""),[p,c]=a.useState(!1),[u,g]=a.useState(!1),[S,w]=a.useState(!1),[f,M]=a.useState(null),[C,I]=a.useState("add"),y=(d==null?void 0:d.permissions["/ingredients"])==="editor",j=a.useCallback(async()=>{try{const t=await b.getIngredients();x(t),i(null)}catch(t){i("Impossible de charger les ingrédients."),console.error(t)}finally{n(!1)}},[]);a.useEffect(()=>{n(!0),j()},[j]);const _=a.useMemo(()=>r.filter(t=>t.nom.toLowerCase().includes(o.toLowerCase())),[r,o]),N=(t,h=null)=>{M(h),t==="add"||t==="edit"?(I(t),c(!0)):t==="resupply"?g(!0):t==="delete"&&w(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mt-6 flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:[e.jsxs("div",{className:"relative w-full md:w-80",children:[e.jsx(L,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Rechercher un ingrédient...",value:o,onChange:t=>m(t.target.value),className:"ui-input pl-10 sm:w-64"})]}),y&&e.jsxs("button",{onClick:()=>N("add"),className:"w-full md:w-auto ui-btn-primary",children:[e.jsx(O,{size:20}),"Ajouter un ingrédient"]})]}),s?e.jsx("p",{className:"text-gray-800",children:"Chargement..."}):l?e.jsx("p",{className:"text-red-500",children:l}):e.jsx("div",{className:"ui-card p-4 overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-sm font-medium text-gray-500 uppercase tracking-wider",children:"Nom"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-500 uppercase tracking-wider",children:"Stock Actuel"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-500 uppercase tracking-wider",children:"Stock Minimum"}),e.jsx("th",{className:"p-3 text-sm font-medium text-gray-500 uppercase tracking-wider",children:"Prix unitaire moyen"}),y&&e.jsx("th",{className:"p-3 text-right text-sm font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:_.map(t=>{const h=t.stock_actuel<=t.stock_minimum;return e.jsxs("tr",{className:`border-b hover:bg-gray-50 ${h?"bg-red-50":""}`,children:[e.jsx("td",{className:`p-3 font-semibold ${h?"text-red-900":"text-gray-900"}`,children:t.nom}),e.jsxs("td",{className:`p-3 font-bold ${h?"text-red-700":"text-gray-800"}`,children:[t.stock_actuel," ",t.unite]}),e.jsxs("td",{className:`p-3 ${h?"text-red-800":"text-gray-700"}`,children:[t.stock_minimum," ",t.unite]}),e.jsx("td",{className:`p-3 ${h?"text-red-800":"text-gray-700"}`,children:F(t.prix_unitaire)}),y&&e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>N("resupply",t),title:"Réapprovisionner",className:"p-2 text-green-600 hover:bg-green-100 rounded-full",children:e.jsx(E,{size:20})}),e.jsx("button",{onClick:()=>N("edit",t),title:"Modifier",className:"p-2 text-blue-600 hover:bg-blue-100 rounded-full",children:e.jsx(R,{size:20})}),e.jsx("button",{onClick:()=>N("delete",t),title:"Supprimer",className:"p-2 text-red-600 hover:bg-red-100 rounded-full",children:e.jsx(P,{size:20})})]})})]},t.id)})})]})}),p&&y&&e.jsx(z,{isOpen:p,onClose:()=>c(!1),onSuccess:j,ingredient:f,mode:C}),u&&y&&f&&e.jsx(T,{isOpen:u,onClose:()=>g(!1),onSuccess:j,ingredient:f}),S&&y&&f&&e.jsx(U,{isOpen:S,onClose:()=>w(!1),onSuccess:j,ingredient:f})]})},z=({isOpen:d,onClose:r,onSuccess:x,ingredient:s,mode:n})=>{const[l,i]=a.useState({nom:(s==null?void 0:s.nom)||"",unite:(s==null?void 0:s.unite)||"g",stock_minimum:(s==null?void 0:s.stock_minimum)||0}),[o,m]=a.useState(!1),p=async c=>{c.preventDefault(),m(!0);try{n==="edit"&&s?await b.updateIngredient(s.id,l):await b.addIngredient(l),x(),r()}catch(u){console.error("Failed to save ingredient",u)}finally{m(!1)}};return e.jsx(k,{isOpen:d,onClose:r,title:n==="add"?"Ajouter un Ingrédient":"Modifier l'Ingrédient",children:e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nom",className:"block text-sm font-medium text-gray-700",children:"Nom"}),e.jsx("input",{type:"text",id:"nom",value:l.nom,onChange:c=>i({...l,nom:c.target.value}),required:!0,className:"mt-1 ui-input"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"unite",className:"block text-sm font-medium text-gray-700",children:"Unité"}),e.jsxs("select",{id:"unite",value:l.unite,onChange:c=>i({...l,unite:c.target.value}),required:!0,className:"mt-1 ui-select",children:[e.jsx("option",{value:"g",children:"Grammes (g)"}),e.jsx("option",{value:"kg",children:"Kilogrammes (kg)"}),e.jsx("option",{value:"ml",children:"Millilitres (ml)"}),e.jsx("option",{value:"L",children:"Litres (L)"}),e.jsx("option",{value:"unite",children:"Unité"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"stock_minimum",className:"block text-sm font-medium text-gray-700",children:"Stock Minimum"}),e.jsx("input",{type:"number",id:"stock_minimum",min:"0",value:l.stock_minimum,onChange:c=>i({...l,stock_minimum:parseFloat(c.target.value)}),required:!0,className:"mt-1 ui-input"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:r,className:"w-full ui-btn-secondary py-3",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:o,className:"w-full ui-btn-primary py-3 disabled:opacity-60",children:o?"Sauvegarde...":"Sauvegarder"})]})]})})},T=({isOpen:d,onClose:r,onSuccess:x,ingredient:s})=>{const[n,l]=a.useState(0),[i,o]=a.useState(0),[m,p]=a.useState(!1),c=async u=>{if(u.preventDefault(),!(n<=0||i<0)){p(!0);try{await b.resupplyIngredient(s.id,n,i),x(),r()}catch(g){console.error("Failed to resupply ingredient",g)}finally{p(!1)}}};return e.jsx(k,{isOpen:d,onClose:r,title:`Réapprovisionner: ${s.nom}`,children:e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"quantity",className:"block text-sm font-medium text-gray-700",children:["Quantité Achetée (",s.unite,")"]}),e.jsx("input",{type:"number",id:"quantity",min:"0.01",step:"0.01",value:n,onChange:u=>l(parseFloat(u.target.value)),required:!0,className:"mt-1 ui-input"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"unitPrice",className:"block text-sm font-medium text-gray-700",children:["Prix par unité (",s.unite,")"]}),e.jsx("input",{type:"number",id:"unitPrice",min:"0",step:"0.01",value:i,onChange:u=>o(parseFloat(u.target.value)),required:!0,className:"mt-1 ui-input"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:r,className:"w-full ui-btn-secondary py-3",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:m,className:"w-full ui-btn-success py-3 disabled:opacity-60",children:m?"Ajout...":"Ajouter au Stock"})]})]})})},U=({isOpen:d,onClose:r,onSuccess:x,ingredient:s})=>{const[n,l]=a.useState(!1),[i,o]=a.useState(null),m=async()=>{l(!0),o(null);try{await b.deleteIngredient(s.id),x(),r()}catch(p){console.error("Failed to delete ingredient",p),o("Impossible de supprimer cet ingrédient car il est utilisé dans au moins une recette.")}finally{l(!1)}};return e.jsxs(k,{isOpen:d,onClose:r,title:"Confirmer la Suppression",children:[e.jsxs("p",{className:"text-gray-700",children:["Êtes-vous sûr de vouloir supprimer l'ingrédient ",e.jsx("strong",{className:"text-gray-900",children:s.nom})," ? Cette action est irréversible."]}),i&&e.jsx("p",{className:"mt-4 text-sm text-red-600",children:i}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-6",children:[e.jsx("button",{type:"button",onClick:r,className:"w-full ui-btn-secondary py-3",children:"Annuler"}),e.jsx("button",{onClick:m,disabled:n,className:"w-full ui-btn-danger py-3 disabled:opacity-60",children:n?"Suppression...":"Supprimer"})]})]})};export{K as default};
